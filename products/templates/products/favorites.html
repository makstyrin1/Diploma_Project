{% extends 'products/base.html' %}
{% load static %}

{% block title %}–ò–∑–±—Ä–∞–Ω–Ω–æ–µ ‚Äî –¢–µ—Ö–Ω–æ–ú–∞—Ä–∫–µ—Ç{% endblock %}

{% block content %}
<!-- CSRF –¥–ª—è –∫—É–∫–∏ -->
<div style="display:none;">{% csrf_token %}</div>

<h1 class="page-title">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</h1>

{% if products %}
<div class="product-grid">
    {% for product in products %}
    <div class="product-card" data-product-id="{{ product.pk }}">
        <a href="{{ product.get_absolute_url }}">
            <div class="product-card__image">
                {% if product.main_image %}
                <img src="{{ product.main_image.url }}" alt="{{ product.name }}">
                {% else %}
                <div class="product-card__placeholder">üì∑</div>
                {% endif %}
            </div>
        </a>
        <div class="product-card__body">
            <div class="product-card__category">
                <a href="{{ product.category.get_absolute_url }}">{{ product.category.name }}</a>
            </div>
            <h3 class="product-card__title">
                <a href="{{ product.get_absolute_url }}">{{ product.name }}</a>
            </h3>
            <p class="product-card__desc">{{ product.description|truncatewords:6 }}</p>
            <div class="product-card__footer">
                <span class="price">{{ product.price }} ‚ÇΩ</span>

                <div class="basket-like">
                    {% if user.is_authenticated %}
                    <!-- –ü–µ—Ä–µ–¥–∞—ë–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π URL —á–µ—Ä–µ–∑ data-url -->
                    <button class="favorite-remove-btn"
                            title="–£–±—Ä–∞—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ"
                            data-product-id="{{ product.pk }}"
                            data-url="{% url 'toggle_favorite' product.pk %}">
                        <img src="{% static 'icons/heart-filled.svg' %}" alt="–í –∏–∑–±—Ä–∞–Ω–Ω–æ–º" class="favorite-icon">
                    </button>
                    {% else %}
                    <a href="{% url 'login' %}" title="–í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã —É–ø—Ä–∞–≤–ª—è—Ç—å –∏–∑–±—Ä–∞–Ω–Ω—ã–º">
                        <img src="{% static 'icons/heart-filled.svg' %}" alt="–ò–∑–±—Ä–∞–Ω–Ω–æ–µ" class="favorite-icon">
                    </a>
                    {% endif %}

                    {% if user.is_authenticated %}
                    <a href="{% url 'cart_add' product.pk %}">
                        <img src="{% static 'icons/cart.svg' %}" alt="–ö–æ—Ä–∑–∏–Ω–∞" id="basket-product">
                    </a>
                    {% else %}
                    <a href="{% url 'login' %}">
                        <img src="{% static 'icons/cart.svg' %}" alt="–ö–æ—Ä–∑–∏–Ω–∞" id="basket-product">
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<p class="empty-state">–í–∞—à–µ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ –ø—É—Å—Ç–æ.</p>
{% endif %}
{% endblock %}