{% extends 'products/base.html' %}
{% load static %}
{% block title %}–ö–∞—Ç–∞–ª–æ–≥ ‚Äî –¢–µ—Ö–Ω–æ–ú–∞—Ä–∫–µ—Ç{% endblock %}

{% block content %}
<!-- –§–æ—Ä–º–∞ –ø–æ–∏—Å–∫–∞ —Å –∏–∫–æ–Ω–∫–æ–π –ª—É–ø—ã -->
<form method="get" class="search-form">
    <div class="search-wrapper">
        <input 
            type="text" 
            name="q" 
            value="{{ request.GET.q|default:'' }}" 
            placeholder="–ü–æ–∏—Å–∫..."
            class="search-input"
        >
        <button type="submit" class="search-icon-btn" aria-label="–ù–∞–π—Ç–∏">
            <img src="{% static 'icons/search.svg' %}" alt="–ü–æ–∏—Å–∫" class="search-icon">
        </button>
    </div>
</form>
<h1 class="page-title">
    {% if current_category %}
    {{ current_category.name }}
    {% else %}
    –£–º–Ω–∞—è —Ç–µ—Ö–Ω–∏–∫–∞
    {% endif %}
</h1>


{% if products %}
<div class="product-grid">
    {% for product in products %}
    <div class="product-card">
        <a href="{{ product.get_absolute_url }}">
            <div class="product-card__image">
                {% if product.main_image %}
                <img src="{{ product.main_image.url }}" alt="{{ product.name }}">
                {% else %}
                <div class="product-card__placeholder">üì∑</div>
                {% endif %}
            </div>
        </a>
        <div class="product-card__body">
            <div class="product-card__category">
                <a href="{{ product.category.get_absolute_url }}">{{ product.category.name }}</a>
            </div>
            <h3 class="product-card__title">
                <a href="{{ product.get_absolute_url }}">{{ product.name }}</a>
            </h3>
            <p class="product-card__desc">{{ product.description|truncatewords:6 }}</p>
            <div class="product-card__footer">
                <span class="price">{{ product.price }} ‚ÇΩ</span>

                <!-- –ö–Ω–æ–ø–∫–∞ "–í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ" -->
                <div class="basket-like">
                    {% if user.is_authenticated %}
                    <form class="favorite-form" method="post" action="{% url 'toggle_favorite' product.pk %}">
                        {% csrf_token %}
                        <button type="submit" class="favorite-btn"
                            title="{% if product.id in user_favorites %}–£–±—Ä–∞—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ{% else %}–í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ{% endif %}"
                            data-product-id="{{ product.pk }}">
                            {% if product.id in user_favorites %}
                            <img src="{% static 'icons/heart-filled.svg' %}" alt="–í –∏–∑–±—Ä–∞–Ω–Ω–æ–º" class="favorite-icon">
                            {% else %}
                            <img src="{% static 'icons/heart-outline.svg' %}" alt="–î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ"
                                class="favorite-icon">
                            {% endif %}
                        </button>
                    </form>
                    {% else %}
                    <a href="{% url 'login' %}" title="–í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–ª—è—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ" class="favorite-btn">
                        <img src="{% static 'icons/heart-outline.svg' %}" alt="Like" class="favorite-icon">
                    </a>
                    {% endif %}


                    <!-- –ö–Ω–æ–ø–∫–∞ "–í –∫–æ—Ä–∑–∏–Ω—É" -->
                    {% if user.is_authenticated %}
                    <a href="{% url 'cart_add' product.pk %}" class="cart-btn">
                        <img src="{% static 'icons/cart.svg' %}" alt="–ö–æ—Ä–∑–∏–Ω–∞">
                    </a>
                    {% else %}
                    <a href="{% url 'login' %}" class="cart-btn">
                        <img src="{% static 'icons/cart.svg' %}" alt="–ö–æ—Ä–∑–∏–Ω–∞">
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<p class="empty-state">
    {% if current_category %}
    –í –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "{{ current_category.name }}" –ø–æ–∫–∞ –Ω–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤.
    {% else %}
    –¢–æ–≤–∞—Ä—ã –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç.
    {% endif %}
</p>
{% endif %}
{% endblock %}