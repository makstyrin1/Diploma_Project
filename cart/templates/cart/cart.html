{% extends 'products/base.html' %}
{% block title %}Корзина — ТехноМаркет{% endblock %}

{% block content %}
<h1 class="page-title">Ваша корзина</h1>

{% if cart_items %}
<div class="cart-items">
  {% for item in cart_items %}
  <div class="cart-item">
    <img src="{{ item.product.main_image.url }}" alt="{{ item.product.name }}" class="cart-img">
    <div class="cart-item__info">
      <h3>{{ item.product.name }}</h3>
      <p>Цена за шт: {{ item.product.price }} ₽</p>
    </div>
    <div class="cart-item__quantity-controls">
      <form method="post" action="{% url 'cart_decrease' item.product.pk %}" class="inline-form">
        {% csrf_token %}
        <button type="submit" class="quantity-btn quantity-btn--minus" title="Уменьшить количество">-</button>
      </form>

      <span class="quantity-display">{{ item.quantity }}</span>

      <form method="post" action="{% url 'cart_increase' item.product.pk %}" class="inline-form">
        {% csrf_token %}
        <button type="submit" class="quantity-btn quantity-btn--plus" title="Увеличить количество">+</button>
      </form>
    </div>

    <!-- Объединяем цену и кнопку в один блок -->
    <div class="cart-item__price-and-remove">
      <div class="cart-item__total">{{ item.total_price }} ₽</div>
      <form method="post" action="{% url 'cart_remove' item.product.pk %}" class="cart-delete-form">
        {% csrf_token %}
        <button type="submit" class="cart-item__remove" title="Удалить из корзины">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"
            stroke-linejoin="round">
            <path d="M3 6h18" />
            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6" />
            <path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
            <line x1="10" y1="11" x2="10" y2="17" />
            <line x1="14" y1="11" x2="14" y2="17" />
          </svg>
        </button>
      </form>
    </div>
  </div>
  {% endfor %}
</div>

<div class="cart-summary">
  <h3>Итого: <span class="total-amount">{{ total }} ₽</span></h3>
  <a href="{% url 'product_list' %}" class="btn btn--outline">Продолжить покупки</a>
</div>
{% else %}
<div class="empty-state">
  <p>Ваша корзина пуста.</p>
  <a href="{% url 'product_list' %}" class="btn">Выбрать товары</a>
</div>
{% endif %}
{% endblock %}